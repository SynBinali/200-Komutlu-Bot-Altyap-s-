const fs = require("fs");
const Canvas = require('canvas')
const Image = Canvas.Image;
const strs = 'abcdefghijklmnopqrstuvwxyz'

module.exports = function(code) {
  function getRandom(n) {
    return Math.floor(Math.random()*(n - 60)) + 30
}
  
  const defaults = {
	charPool:  ( strs + strs.toUpperCase() + '1234567890').split('')
	,size: {
		width: 100
		,height: 32
	}
	,textPos: {
		left: 15
		,top: 26
	}
	,rotate: .01
	,charLength: 4,font: '26px Sans',strokeStyle: '#00C27B',bgColor: '#EEEEEE',confusion: true,cFont: '30px Arial',cStrokeStyle: '#adc',cRotate: -.05
}
	

	const canvas = Canvas.createCanvas(200, 200);
	let ctx = canvas.getContext('2d');
	let ctext = code;
	let text = code;

	ctx.fillStyle = defaults.bgColor
	ctx.fillRect(0, 0, defaults.size.width, defaults.size.height)

	if(defaults.confusion) {
		ctx.beginPath()
		ctx.font = defaults.cFont
		ctx.rotate(defaults.cRotate)
		ctx.strokeStyle = defaults.cStrokeStyle
		ctx.strokeText(ctext, defaults.textPos.left, defaults.textPos.top)
	}

	ctx.beginPath()
	ctx.strokeStyle = defaults.strokeStyle
	ctx.font = defaults.font
	ctx.rotate(defaults.rotate)
	ctx.strokeText(text, defaults.textPos.left, defaults.textPos.top)
  
  
  
    
  return {buffer:canvas.toBuffer(),base64:'data:image/png;base64,'+canvas.toBuffer().toString('base64')};
  

  
};